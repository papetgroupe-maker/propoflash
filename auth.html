<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PropoFlash — Connexion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{ --ink:#0a1020; --muted:#667085; --stroke:#e6e9f3; --accent:#111827; --accent-ink:#fff; --pill:#f6f9ff; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff}
    .top{position:sticky;top:0;z-index:2;border-bottom:1px solid var(--stroke);background:#fff;display:flex;justify-content:space-between;align-items:center;padding:10px 14px}
    .brand{display:flex;gap:10px;align-items:center;cursor:pointer;font-weight:800}
    .spark{width:22px;height:22px;border-radius:6px;background:conic-gradient(from 180deg,#93c5fd,#c4b5fd,#60a5fa,#93c5fd)}
    .top select{border:1px solid var(--stroke);border-radius:10px;padding:8px 10px}
    .page{min-height:100%;display:grid;grid-template-columns:520px 1fr}
    .left{display:flex;align-items:center;justify-content:center;padding:24px}
    .left-inner{width:100%;max-width:420px}
    h1{font-size:44px;line-height:1.05;margin:0 0 6px;font-weight:900;letter-spacing:-.02em}
    .subtitle{font-size:18px;color:var(--muted);margin:0 0 18px}
    .btn{width:100%;border:1px solid var(--stroke);background:#fff;border-radius:10px;padding:12px 14px;font-weight:700;cursor:pointer;text-align:center}
    .btn.black{background:var(--accent);color:var(--accent-ink);border-color:#0000}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .field{margin-top:12px}
    label{display:block;font-size:13px;color:#475569;margin:0 0 6px}
    input{width:100%;border:1px solid var(--stroke);border-radius:10px;padding:12px 12px;font:500 14px/1.2 Inter}
    .or{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:10px;color:#98a2b3;margin:14px 0}
    .or::before,.or::after{content:"";height:1px;background:var(--stroke)}
    .hint{font-size:13px;color:var(--muted)}
    .link{color:#0a66ff;text-decoration:none}
    .space{height:10px}
    .err{background:#fff2f2;border:1px solid #ffd7d7;color:#b42318;border-radius:10px;padding:10px 12px;font-size:13px;margin-bottom:10px;display:none}
    .ok{background:#f1fff3;border:1px solid #c9f1cf;color:#067647;border-radius:10px;padding:10px 12px;font-size:13px;margin-bottom:10px;display:none}

    .right{position:relative;overflow:hidden;background:radial-gradient(1200px 600px at 60% 30%, #eaf2ff, #f7f9ff 60%, #ffffff 100%)}
    .blob{position:absolute;inset:-20% -10% auto -10%;height:120%;
      background:radial-gradient(40% 40% at 70% 30%, rgba(59,130,246,.35), transparent 60%), radial-gradient(40% 40% at 30% 70%, rgba(139,92,246,.25), transparent 60%); filter:blur(40px)}
    .search{position:absolute;left:50%;top:50%;transform: translate(-50%,-50%);width:min(700px,70%);height:74px;border-radius:999px;background:linear-gradient(180deg,#ffffffcc,#ffffff80);
      border:1px solid #e7edf9; box-shadow:0 12px 36px rgba(11,25,70,.12); display:flex;align-items:center;padding:0 8px 0 24px;backdrop-filter:blur(8px)}
    .search span{color:#616c80;font-weight:600;font-size:26px;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .go{margin-left:auto;width:54px;height:54px;border-radius:16px;background:#fff;border:1px solid #e6ebf7;display:grid;place-items:center;box-shadow:0 10px 24px rgba(0,0,0,.06)}
    .go svg{width:22px;height:22px;stroke:#6b7280}

    @media (max-width:980px){
      .page{grid-template-columns:1fr}
      .right{display:none}
      .left{padding:18px}
      h1{font-size:36px}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="site-lang.js"></script>
</head>
<body>
  <!-- Top bar (logo + sélecteur global) -->
  <div class="top">
    <div class="brand" onclick="location.href='index.html'"><div class="spark"></div>PropoFlash</div>
    <select data-lang-picker>
      <option value="fr">FR</option><option value="en">EN</option>
    </select>
  </div>

  <div class="page">
    <div class="left">
      <div class="left-inner">
        <h1 data-i18n="title">Welcome to<br/>PropoFlash</h1>
        <p class="subtitle" data-i18n="subtitle">Connectez-vous pour créer et envoyer vos propositions.</p>

        <div id="msgErr" class="err"></div>
        <div id="msgOk"  class="ok"></div>

        <button id="googleBtn" class="btn">
          <span style="display:inline-flex;align-items:center;gap:10px;justify-content:center">
            <img alt="" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18">
            <span data-i18n="login_google">Log in with Google</span>
          </span>
        </button>

        <div class="or" data-i18n="or">OR</div>

        <div class="field">
          <label data-i18n="email">Email</label>
          <input id="email" type="email" placeholder="" autocomplete="email">
        </div>
        <div class="field">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <label data-i18n="password">Password</label>
            <a href="#" id="forgot" class="link" style="font-size:12px" data-i18n="forgot">Forgot password?</a>
          </div>
          <input id="password" type="password" placeholder="" autocomplete="current-password">
        </div>

        <div class="space"></div>
        <button id="submitBtn" class="btn black" data-i18n="login_btn">Log In</button>

        <div class="space"></div>
        <p class="hint" id="footHint">
          <span data-i18n="no_acc">Don't have an account?</span>
          <a href="#" id="toggle" class="link" data-i18n="signup">Sign up</a>
          &nbsp;&nbsp;·&nbsp; <a href="index.html" class="link" data-i18n="back_home">← Back to home</a>
        </p>
      </div>
    </div>

    <div class="right" aria-hidden="true">
      <div class="blob"></div>
      <div class="search">
        <span data-i18n="hero_right">Transformez vos idées en propositions</span>
        <div class="go"><svg viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2"><path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path></svg></div>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL  = 'https://lxiaaplvbitqqgvaxelt.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4aWFhcGx2Yml0cXFndmF4ZWx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MTU0NjQsImV4cCI6MjA3MjM5MTQ2NH0.C3LzDFt67_GM978JIkSHDShmrr0mSYBr4jjVUxXgKtE';
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    const I18N = {
      fr: {
        title:"Bienvenue sur<br/>PropoFlash", subtitle:"Connectez-vous pour créer et envoyer vos propositions.",
        login_google:"Se connecter avec Google", or:"OU", email:"Email", password:"Mot de passe",
        forgot:"Mot de passe oublié ?", login_btn:"Se connecter",
        no_acc:"Pas de compte ?", signup:"Créer un compte", back_home:"← Retour à l’accueil",
        email_ph:"Entrez votre email", pass_ph:"Entrez votre mot de passe",
        ok_already:"Vous êtes déjà connecté·e. Redirection…",
        ok_created:"Compte créé. Vérifiez votre email si nécessaire.",
        ok_signedin:"Connexion réussie. Redirection…",
        ok_reset_sent:"Lien de réinitialisation envoyé. Consultez votre boîte mail.",
        err_required:"Email et mot de passe requis.",
        hero_right:"Transformez vos idées en propositions"
      },
      en: {
        title:"Welcome to<br/>PropoFlash", subtitle:"Sign in to create and send your proposals.",
        login_google:"Log in with Google", or:"OR", email:"Email", password:"Password",
        forgot:"Forgot password?", login_btn:"Log In",
        no_acc:"Don't have an account?", signup:"Sign up", back_home:"← Back to home",
        email_ph:"Enter your email", pass_ph:"Enter your password",
        ok_already:"You’re already signed in. Redirecting…",
        ok_created:"Account created. Check your email if confirmation is required.",
        ok_signedin:"Signed in. Redirecting…",
        ok_reset_sent:"Reset link sent. Check your inbox.",
        err_required:"Email and password are required.",
        hero_right:"Turn ideas into proposals"
      }
    };

    const $ = (q,ctx=document)=>ctx.querySelector(q);
    const msgErr  = $('#msgErr');
    const msgOk   = $('#msgOk');
    const emailEl = $('#email');
    const passEl  = $('#password');
    const submit  = $('#submitBtn');
    const google  = $('#googleBtn');
    const forgot  = $('#forgot');
    const toggle  = $('#toggle');
    let mode='login';

    function t(k){ const L=I18N[getLang()]||I18N.en; return L[k]||k; }
    function showErr(s){ msgErr.textContent=s; msgErr.style.display='block'; msgOk.style.display='none'; }
    function showOk(s){ msgOk.textContent=s; msgOk.style.display='block'; msgErr.style.display='none'; }
    function clearMsg(){ msgErr.style.display='none'; msgOk.style.display='none'; }

    function applyI18N(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{ const k=el.dataset.i18n; el.innerHTML=t(k); });
      emailEl.placeholder = t('email_ph');
      passEl.placeholder  = t('pass_ph');
      submit.textContent  = mode==='login' ? t('login_btn') : t('signup');
    }
    window.addEventListener('langchange', applyI18N);
    document.addEventListener('DOMContentLoaded', applyI18N);

    // Déjà connecté ? → studio
    (async ()=>{
      const { data:{ session } } = await sb.auth.getSession();
      if(session){ showOk(t('ok_already')); setTimeout(()=>location.href='studio.html',600); }
    })();

    google.onclick = async ()=>{
      clearMsg();
      try{
        const { error } = await sb.auth.signInWithOAuth({ provider:'google', options:{ redirectTo: window.location.origin + '/studio.html' }});
        if(error) showErr(error.message);
      }catch(e){ showErr(String(e.message||e)); }
    };

    toggle.onclick = (e)=>{
      e.preventDefault(); clearMsg();
      if(mode==='login'){ mode='signup'; toggle.textContent=t('login_btn'); }
      else{ mode='login'; toggle.textContent=t('signup'); }
      applyI18N();
    };

    submit.onclick = async ()=>{
      clearMsg();
      const email=(emailEl.value||'').trim(), password=passEl.value||'';
      if(!email||!password){ showErr(t('err_required')); return; }
      submit.disabled=true;
      try{
        if(mode==='signup'){
          const { error } = await sb.auth.signUp({ email, password });
          if(error) showErr(error.message); else showOk(t('ok_created'));
        }else{
          const { error } = await sb.auth.signInWithPassword({ email, password });
          if(error) showErr(error.message); else { showOk(t('ok_signedin')); setTimeout(()=>location.href='studio.html',400); }
        }
      }catch(e){ showErr(String(e.message||e)); }
      finally{ submit.disabled=false; }
    };

    forgot.onclick = async (e)=>{
      e.preventDefault(); clearMsg();
      const email=(emailEl.value||'').trim() || prompt(t('email_ph')); if(!email) return;
      try{
        const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin + '/auth.html#reset' });
        if(error) showErr(error.message); else showOk(t('ok_reset_sent'));
      }catch(e){ showErr(String(e.message||e)); }
    };

    if(location.hash==='#reset'){ showOk(t('ok_reset_sent')); }
  </script>
</body>
</html>
